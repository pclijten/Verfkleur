<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>VerfMuren Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
      import { getStorage, ref, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDZ7ptEUMHoOsln9B0FZ_Juct0KZUk5cvs",
        authDomain: "verfmuren.firebaseapp.com",
        projectId: "verfmuren",
        storageBucket: "verfmuren.appspot.com",
        messagingSenderId: "419449044998",
        appId: "1:419449044998:web:9511b6f54d6e378850c387",
        measurementId: "G-0XH7PJXJXN"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const storage = getStorage(app);

      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("verfForm");
        const status = document.getElementById("status");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          status.textContent = "‚è≥ Bezig met opslaan...";
          const fd = new FormData(form);

          const muurfile = fd.get("muurfoto");
          const blikfile = fd.get("verfblikfoto");

          const toBase64 = (file) => {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => resolve(reader.result);
              reader.onerror = reject;
              reader.readAsDataURL(file);
            });
          };

          try {
            const muurDataUrl = await toBase64(muurfile);
            const blikDataUrl = await toBase64(blikfile);

            const muurRef = ref(storage, `muurfotos/${Date.now()}_muur.jpg`);
            const blikRef = ref(storage, `verfblikken/${Date.now()}_blik.jpg`);

            await uploadString(muurRef, muurDataUrl, 'data_url');
            await uploadString(blikRef, blikDataUrl, 'data_url');

            const muurUrl = await getDownloadURL(muurRef);
            const blikUrl = await getDownloadURL(blikRef);

            await addDoc(collection(db, "verfregistraties"), {
              tijd: new Date().toISOString(),
              locatie: fd.get("locatie") || "",
              merk: fd.get("merk") || "",
              kleurcode: fd.get("kleurcode") || "",
              type: fd.get("type") || "",
              gekocht: fd.get("gekocht") || "",
              opmerkingen: fd.get("opmerkingen") || "",
              muurFotoUrl: muurUrl,
              verfBlikFotoUrl: blikUrl
            });

            status.textContent = "‚úÖ Verf opgeslagen!";
            form.reset();
          } catch (err) {
            console.error(err);
            status.textContent = "‚ùå Fout bij opslaan: " + err;
          }
        });
      });
    </script>
  </head>
  <body class="bg-gray-100 p-6">
    <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow">
      <h1 class="text-2xl font-bold mb-4">üé® VerfMuur Registratie (Firebase)</h1>
      <form id="verfForm" class="space-y-4">
        <input type="text" name="locatie" placeholder="Locatie" required class="w-full border p-2 rounded" />
        <input type="text" name="merk" placeholder="Merk" class="w-full border p-2 rounded" />
        <input type="text" name="kleurcode" placeholder="Kleurcode" class="w-full border p-2 rounded" />
        <input type="text" name="type" placeholder="Type" class="w-full border p-2 rounded" />
        <input type="date" name="gekocht" class="w-full border p-2 rounded" />
        <textarea name="opmerkingen" placeholder="Opmerkingen" class="w-full border p-2 rounded"></textarea>
        <label>Muurfoto: <input type="file" name="muurfoto" accept="image/*" required></label>
        <label>Verfblikfoto: <input type="file" name="verfblikfoto" accept="image/*" required></label>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Opslaan</button>
        <div id="status" class="mt-2 text-sm text-gray-600"></div>
      </form>
    </div>
  </body>
</html>
